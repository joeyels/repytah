

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Utilities &mdash; repytah  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Transform" href="transform.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> repytah
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="about.html">Why <cite>repytah</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
</ul>
<p><span class="caption-text">Modules</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="transform.html">Transform</a></li>
<li class="toctree-l1"><a class="reference internal" href="assemble.html">Assemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="search_doc.html">Search</a></li>
</ul>
<p><span class="caption-text">Implementation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_vignette.html">Example of Creating Aligned Hierarchies for a Mazurka Score</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">repytah</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Utilities</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/utilities.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="module-repytah.utilities">
<span id="utilities"></span><h1>Utilities<a class="headerlink" href="#module-repytah.utilities" title="Permalink to this headline">¶</a></h1>
<p>utilities.py</p>
<p>This script when imported as a module allows search.py, transform.py and
assemble.py in the repytah package to run smoothly.</p>
<p>This file contains the following functions:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>create_sdm</dt><dd><p>Creates a self-dissimilarity matrix; this matrix is found
by creating audio shingles from feature vectors, and finding cosine
distance between shingles.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>find_initial_repeats</dt><dd><p>Finds all diagonals present in thresh_mat, removing each diagonal
as it is found.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>stretch_diags</dt><dd><p>Fills out diagonals in binary self-dissimilarity matrix from diagonal
starts and lengths.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>add_annotations</dt><dd><p>Adds annotations to each pair of repeated structures according to
their length and order of occurrence.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>__find_song_pattern</dt><dd><p>Stitches information about repeat locations from thresh_diags matrix
into a single row.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>reconstruct_full_block</dt><dd><p>Creates a record of when pairs of repeated structures occur, from
the first beat in the song to the last beat of the song. Pairs of
repeated structures are marked with 1’s.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>get_annotation_lst</dt><dd><p>Gets one annotation marker vector, given vector of lengths key_lst.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>get_yLabels</dt><dd><p>Generates the labels for visualization.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>reformat [Only used for creating test examples]</dt><dd><p>Transforms a binary matrix representation of when repeats occur in
a song into a list of repeated structures detailing the length and
occurrence of each repeat.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<dl class="py function">
<dt id="repytah.utilities.__find_song_pattern">
<code class="sig-prename descclassname">repytah.utilities.</code><code class="sig-name descname">__find_song_pattern</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">thresh_diags</span></em><span class="sig-paren">)</span><a class="headerlink" href="#repytah.utilities.__find_song_pattern" title="Permalink to this definition">¶</a></dt>
<dd><p>Stitches information from thresh_diags matrix into a single
row, song_pattern, that shows the timesteps containing repeats;
From the full matrix that decodes repeat beginnings (thresh_diags),
the locations, or beats, where these repeats start are found and
encoded into the song_pattern array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>thresh_diags</strong> (<em>np.ndarray</em>) – Binary matrix with 1 at the start of each repeat pair (SI,SJ) and
0 elsewhere.
WARNING: Must be symmetric.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>song_pattern</strong> – Row where each entry represents a time step and the group
that time step is a member of.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="repytah.utilities.add_annotations">
<code class="sig-prename descclassname">repytah.utilities.</code><code class="sig-name descname">add_annotations</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input_mat</span></em>, <em class="sig-param"><span class="n">song_length</span></em><span class="sig-paren">)</span><a class="headerlink" href="#repytah.utilities.add_annotations" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds annotations to the pairs of repeats in input_mat.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_mat</strong> (<em>np.ndarray</em>) – List of pairs of repeats. The first two columns refer to
the first repeat of the pair. The third and fourth columns
refer to the second repeat of the pair. The fifth column
refers to the repeat lengths. The sixth column contains any
previous annotations, which will be removed.</p></li>
<li><p><strong>song_length</strong> (<em>int</em>) – Number of audio shingles in the song.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>anno_list</strong> – List of pairs of repeats with annotations marked.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="repytah.utilities.create_sdm">
<code class="sig-prename descclassname">repytah.utilities.</code><code class="sig-name descname">create_sdm</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">fv_mat</span></em>, <em class="sig-param"><span class="n">num_fv_per_shingle</span></em><span class="sig-paren">)</span><a class="headerlink" href="#repytah.utilities.create_sdm" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates self-dissimilarity matrix; this matrix is found by creating audio
shingles from feature vectors, and finding the cosine distance between
shingles.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fv_mat</strong> (<em>np.ndarray</em>) – Matrix of feature vectors where each column is a timestep and each
row includes feature information i.e. an array of 144 columns/beats
and 12 rows corresponding to chroma values.</p></li>
<li><p><strong>num_fv_per_shingle</strong> (<em>int</em>) – Number of feature vectors per audio shingle.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>self_dissim_mat</strong> – Self-dissimilarity matrix with paired cosine distances between shingles.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="repytah.utilities.find_initial_repeats">
<code class="sig-prename descclassname">repytah.utilities.</code><code class="sig-name descname">find_initial_repeats</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">thresh_mat</span></em>, <em class="sig-param"><span class="n">bandwidth_vec</span></em>, <em class="sig-param"><span class="n">thresh_bw</span></em><span class="sig-paren">)</span><a class="headerlink" href="#repytah.utilities.find_initial_repeats" title="Permalink to this definition">¶</a></dt>
<dd><p>Looks for the largest repeated structures in thresh_mat. Finds all
repeated structures, represented as diagonals present in thresh_mat,
and then stores them with their start/end indices and lengths in a
list. As each diagonal is found, they are removed to avoid identifying
repeated sub-structures.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>thresh_mat</strong> (<em>np.ndarray</em><em>[</em><em>int</em><em>]</em>) – Thresholded matrix that we extract diagonals from.</p></li>
<li><p><strong>bandwidth_vec</strong> (<em>np.ndarray</em><em>[</em><em>1D</em><em>,</em><em>int</em><em>]</em>) – Array of lengths of diagonals to be found. Should be
1,2,3,….. n where n = num_timesteps.</p></li>
<li><p><strong>thresh_bw</strong> (<em>int</em>) – Smallest allowed diagonal length.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>all_lst</strong> – List of pairs of repeats that correspond to diagonals in
thresh_mat.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="repytah.utilities.get_annotation_lst">
<code class="sig-prename descclassname">repytah.utilities.</code><code class="sig-name descname">get_annotation_lst</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key_lst</span></em><span class="sig-paren">)</span><a class="headerlink" href="#repytah.utilities.get_annotation_lst" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates one annotation marker vector, given vector of lengths key_lst.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key_lst</strong> (<em>np.ndarray</em><em>[</em><em>int</em><em>]</em>) – Array of lengths in ascending order.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>anno_lst_out</strong> – Array of one possible set of annotation markers for key_lst.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="repytah.utilities.get_yLabels">
<code class="sig-prename descclassname">repytah.utilities.</code><code class="sig-name descname">get_yLabels</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">width_vec</span></em>, <em class="sig-param"><span class="n">anno_vec</span></em><span class="sig-paren">)</span><a class="headerlink" href="#repytah.utilities.get_yLabels" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates the labels for visualization with width_vec and anno_vec.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>width_vec</strong> (<em>np.ndarray</em><em>[</em><em>int</em><em>]</em>) – Vector of widths for a visualization.</p></li>
<li><p><strong>anno_vec</strong> (<em>np.ndarray</em><em>[</em><em>int</em><em>]</em>) – Array of annotations for a visualization.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>ylabels</strong> – Labels for the y-axis of a visualization.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="repytah.utilities.reconstruct_full_block">
<code class="sig-prename descclassname">repytah.utilities.</code><code class="sig-name descname">reconstruct_full_block</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pattern_mat</span></em>, <em class="sig-param"><span class="n">pattern_key</span></em><span class="sig-paren">)</span><a class="headerlink" href="#repytah.utilities.reconstruct_full_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a record of when pairs of repeated structures occur, from the
first beat in the song to the end. This record is a binary matrix with a
block of 1’s for each repeat encoded in pattern_mat whose length is
encoded in pattern_key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pattern_mat</strong> (<em>np.ndarray</em>) – Binary matrix with 1’s where repeats begin and 0’s otherwise.</p></li>
<li><p><strong>pattern_key</strong> (<em>np.ndarray</em>) – Vector containing the lengths of the repeats encoded in
each row of pattern_mat.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>pattern_block</strong> – Binary matrix representation for pattern_mat with blocks
of 1’s equal to the length’s prescribed in pattern_key.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="repytah.utilities.reformat">
<code class="sig-prename descclassname">repytah.utilities.</code><code class="sig-name descname">reformat</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pattern_mat</span></em>, <em class="sig-param"><span class="n">pattern_key</span></em><span class="sig-paren">)</span><a class="headerlink" href="#repytah.utilities.reformat" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms a binary array with 1’s where repeats start and 0’s
otherwise into a list of repeated stuctures. This list consists of
information about the repeats including length, when they occur and when
they end.</p>
<p>Every row has a pair of repeated structure. The first two columns are
the time steps of when the first repeat of a repeated structure start and
end. Similarly, the second two columns are the time steps of when the
second repeat of a repeated structure start and end. The fifth column is
the length of the repeated structure.</p>
<p>Reformat is not used in the main process for creating the
aligned-hierarchies. It is helpful when writing example inputs for
the tests.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pattern_mat</strong> (<em>np.ndarray</em>) – Binary array with 1’s where repeats start and 0’s otherwise.</p></li>
<li><p><strong>pattern_key</strong> (<em>np.ndarray</em>) – Array with the lengths of each repeated structure in pattern_mat.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>info_mat</strong> – Array with the time steps of when the pairs of repeated structures
start and end organized.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="repytah.utilities.stretch_diags">
<code class="sig-prename descclassname">repytah.utilities.</code><code class="sig-name descname">stretch_diags</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">thresh_diags</span></em>, <em class="sig-param"><span class="n">band_width</span></em><span class="sig-paren">)</span><a class="headerlink" href="#repytah.utilities.stretch_diags" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a binary matrix with full length diagonals from a binary matrix of
diagonal starts and length of diagonals.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>thresh_diags</strong> (<em>np.ndarray</em>) – Binary matrix where entries equal to 1 signals the existence
of a diagonal.</p></li>
<li><p><strong>band_width</strong> (<em>int</em>) – Length of encoded diagonals.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>stretch_diag_mat</strong> – Logical matrix with diagonals of length band_width starting
at each entry prescribed in thresh_diag.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray[bool]</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="transform.html" class="btn btn-neutral float-right" title="Transform" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, repytah development team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>